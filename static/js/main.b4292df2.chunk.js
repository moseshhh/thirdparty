(this.webpackJsonpthird_party=this.webpackJsonpthird_party||[]).push([[0],{356:function(e,t,a){e.exports=a(627)},361:function(e,t,a){},626:function(e,t,a){},627:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(19),o=a.n(i),l=(a(361),a(38)),s=a(645),c=a(56),u=a(643),m=a(649),d=a(640),p=a(174),f=a(634),y=a(638),v=a(136),g=a(635),h=a(39),b=a.n(h),E={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},w={xs:{span:24,offset:0},sm:{span:16,offset:8}},k=function(e){var t=Object(n.useState)(!0),a=Object(l.a)(t,2),i=a[0],o=a[1],s=Object(n.useState)(!0),u=Object(l.a)(s,2),m=u[0],h=u[1],k=Object(n.useState)("todate"),D=Object(l.a)(k,2),P=D[0],j=D[1];var S=e.timesRange;return r.a.createElement(d.a,Object.assign({name:"deforestation_control"},E,{onFinish:function(t){return e.onFinish(t,P)}}),r.a.createElement(p.a.Group,{onChange:function(e){j(e.target.value),"period"==e.target.value?(h(!1),o(!0)):"range-picker"==e.target.value?(h(!0),o(!1)):("all"==e.target.value||"todate"==e.target.value)&&(h(!0),o(!0))},value:P},r.a.createElement(p.a,{value:"todate"},"To Date"),r.a.createElement(p.a,{value:"range-picker"},"Time Range"),r.a.createElement(p.a,{value:"period"},"Time Period"),r.a.createElement(p.a,{value:"all"},"Select All")),r.a.createElement(f.a,null),r.a.createElement(d.a.Item,{name:"range-picker",label:"Time Range"},r.a.createElement(y.a.RangePicker,{format:"YYYY/MM/DD",disabled:i})),r.a.createElement(f.a,null,"Or"),r.a.createElement(d.a.Item,{name:"period-time",label:"Period Time"},r.a.createElement(v.a,{placeholder:"select time period",disabled:m},S.map((function(e,t){var a=Object(l.a)(e,2),n=a[0],i=a[1];return r.a.createElement(v.a.Option,{key:t,value:"".concat(b()(n).format("YYYY-MM-DD"),"|").concat(b()(i).format("YYYY-MM-DD"))},b()(n).format("MMM Do YYYY")," - ",b()(i).format("MMM Do YYYY"))})))),r.a.createElement(d.a.Item,{wrapperCol:w},r.a.createElement(g.a,null,r.a.createElement(c.a,{type:"primary",htmlType:"submit",id:"button-form-deforestation"},"Submit"),r.a.createElement(c.a,{type:"primary",onClick:e.onClear},"Clear"))))},D=function(e){var t=Object(n.useState)(!1),a=Object(l.a)(t,2),i=a[0],o=a[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"button-notif"},r.a.createElement(s.a,{count:e.count},r.a.createElement(c.a,{type:"primary",shape:"circle",size:"large",id:"buttonNotif",onClick:e.onClick},r.a.createElement(m.a,null)))),r.a.createElement(u.a,{title:"Deforestation",placement:"right",closable:!0,onClose:function(){o(!1)},visible:i,width:500}))},P=a(105),j=a(636),S=a(124),O=a(50),M=a(51),C=a(53),I=a(52),_=r.a.createContext(),A=_.Provider,x=_.Consumer,T=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){var e;Object(O.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={activePage:"map"},e.f_setActivePage=function(t){e.setState({activePage:t})},e}return Object(M.a)(a,[{key:"render",value:function(){return r.a.createElement(A,{value:Object(S.a)(Object(S.a)({},this.state),{},{f_setActivePage:this.f_setActivePage})},this.props.children)}}]),a}(r.a.Component),F=a(650),L=a(651),Y=(P.a.SubMenu,function(e){var t=Object(n.useContext)(_),a=Object(n.useState)(!0),i=Object(l.a)(a,2),o=i[0];i[1];return r.a.createElement(j.a.Sider,{collapsed:o},r.a.createElement("div",{className:"logo"}),r.a.createElement(P.a,{theme:"dark",onClick:function(e){t.f_setActivePage(e.key)},defaultSelectedKeys:[t.activePage],mode:"inline"},r.a.createElement(P.a.Item,{key:"dashboard",icon:r.a.createElement(F.a,null)}),r.a.createElement(P.a.Item,{key:"map",icon:r.a.createElement(L.a,null)},"Maps")))}),R=a(139),N=a.n(R),G=a(217),H=a(116),B=a(646),z=a(637),q=a(125),K=a(70),V=a(641),U=a(648),W=a(138),J=a(647),Q=a(88),Z=a(307),X=a(642),$=a(652),ee=function(e){var t=Object(n.useState)(!1),a=Object(l.a)(t,2),i=a[0],o=a[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"button-clear"},r.a.createElement(s.a,{count:e.count},r.a.createElement(c.a,{type:"primary",shape:"circle",size:"large",id:"buttonClear",onClick:e.onClick},r.a.createElement($.a,null)))),r.a.createElement(u.a,{title:"Deforestation",placement:"right",closable:!0,onClose:function(){o(!1)},visible:i,width:500}))},te=a(653),ae=function(e){return r.a.createElement("div",{className:e.className},r.a.createElement(c.a,{type:"primary",shape:"circle",size:"large",id:"buttonClear",onClick:e.onClick,danger:!0},r.a.createElement(te.a,null)))},ne=a(639),re=function(e){var t=e.impacted?{backgroundColor:"red"}:null;return r.a.createElement(ne.a,{type:"inner",title:"Deforestation ".concat(e.index),headStyle:t,extra:r.a.createElement(c.a,{type:"dashed",onClick:e.zoomTo},"Zoom to")},r.a.createElement(B.a,{size:"small",layout:"vertical"},r.a.createElement(B.a.Item,{label:"Latitude"},e.lat),r.a.createElement(B.a.Item,{label:"Longitude"},e.lon),r.a.createElement(B.a.Item,{label:"Start Date"},b()(new Date(e.startdate)).format("yyyy/MM/DD")),r.a.createElement(B.a.Item,{label:"End Date"},b()(new Date(e.enddate)).format("yyyy/MM/DD")),r.a.createElement(B.a.Item,{label:"Peatland"},e.peatland," ha"),r.a.createElement(B.a.Item,{label:"Mangrove"},e.mangrove," ha"),r.a.createElement(B.a.Item,{label:"Other"},e.other," ha"),r.a.createElement(B.a.Item,{label:"Total"},e.total," ha")))},ie=a(328),oe=a(299),le=(a(479),a(131)),se=(a(252),new le.default({orientation:"landscape"})),ce=[{title:"Pom Name",dataIndex:"name",key:"name",span:10,sorter:function(e,t){return e.name.localeCompare(t.name)},sortDirections:["ascend"]},{title:"Company",dataIndex:"company",key:"company",span:10},{title:"Group",dataIndex:"group",key:"group",span:10},{title:"District",dataIndex:"kabupaten",key:"kabupaten",span:10},{title:"Province",dataIndex:"province",key:"province",span:10},{title:"Capacity",dataIndex:"capacity",key:"capacity",span:10},{title:"Distance (estimation) in Km",dataIndex:"distance",key:"distance",span:10,sorter:function(e,t){return e.distance-t.distance}},{title:"Status",dataIndex:"status",key:"status",span:10,render:function(e){var t="warning"==e?"yellow":"red";return r.a.createElement(ie.a,{color:t,key:e},e)}}],ue=[{title:"Concession",dataIndex:"name",key:"name",span:10},{title:"Group",dataIndex:"group",key:"groupe",span:10},{title:"Province",dataIndex:"province",key:"provincee",span:10},{title:"Total Area",dataIndex:"totalArea",key:"totalArea",span:10},{title:"Impacted",dataIndex:"totalImpacted",key:"totalImpacted",span:10},{title:"Distance in Km (Estimation)",dataIndex:"distance",key:"distance",span:10,sorter:function(e,t){return e.distance-t.distance}},{title:"Status",dataIndex:"status",key:"status",span:10,render:function(e){var t="warning"==e?"yellow":"red";return r.a.createElement(ie.a,{color:t,key:e},e)}}],me=[{title:"Remarks",dataIndex:"remark",key:"remark",span:10},{title:"Distance in Km (Estimation)",dataIndex:"distance",key:"distance",span:10,sorter:function(e,t){return e.distance-t.distance}},{title:"Total Area",dataIndex:"area",key:"area",span:10}],de=[{title:"Latitude",dataIndex:"latitude",key:"latitude",span:10},{title:"Longitude",dataIndex:"longitude",key:"longitude",span:10},{title:"Acquisition Date",dataIndex:"acq_date",key:"acq_date",span:10},{title:"Verification",dataIndex:"verification",key:"verification",span:10}],pe=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(e){var n;return Object(O.a)(this,a),(n=t.call(this,e)).generatePdf=function(){se.text("Basic Information",14,20),se.text("Location : 100.2854, 2.3290",14,30),se.text("Radius : 40 Km",14,40),se.text("Time Period : 8/28/2020 - 9/10/2020",14,50);var e=ce.map((function(e){return e.title})),t=n.state.pomData.map((function(e){return[e.name,e.company,e.group,e.kabupaten,e.province,e.capacity,e.distance,e.status]}));se.text("3rd Party Mill",14,70),se.autoTable({head:[e],body:t,startY:75,rowPageBreak:"auto",bodyStyles:{valign:"top"}});var a=ue.map((function(e){return e.title})),r=n.state.concData.map((function(e){return[e.name,e.group,e.province,e.totalArea,e.totalImpacted,e.distance,e.status]}));se.text("Concession",14,se.lastAutoTable.finalY+20),se.autoTable({head:[a],body:r,startY:se.lastAutoTable.finalY+25,rowPageBreak:"auto",bodyStyles:{valign:"top"}});var i=me.map((function(e){return e.title})),o=n.state.peatData.map((function(e){return[e.remark,e.distance,e.area]}));se.text("Peatland",14,se.lastAutoTable.finalY+20),se.autoTable({head:[i],body:o,startY:se.lastAutoTable.finalY+25,rowPageBreak:"auto",bodyStyles:{valign:"top"}});var l=de.map((function(e){return e.title})),s=n.state.hotspotData.map((function(e){return[e.latitude,e.longitude,e.acq_date,e.verification]}));se.text("HotSpot",14,se.lastAutoTable.finalY+20),se.autoTable({head:[l],body:s,startY:se.lastAutoTable.finalY+25,rowPageBreak:"auto",bodyStyles:{valign:"top"}}),se.save("table.pdf")},n.processingData=function(){Object(H.loadModules)(["esri/geometry/geometryEngine","esri/geometry/projection","esri/geometry/SpatialReference"]).then((function(e){var t=Object(l.a)(e,3),a=t[0],r=t[1],i=t[2],o=n.props,s=Object(l.a)(o.data,4),c=s[0],u=s[1],m=s[2],d=s[3];console.log("modalcontent",o.data);var p={latitude:o.location.latitude,longitude:o.location.longitude},f=c.map((function(e,t){var a={latitude:e.geometry.latitude,longitude:e.geometry.longitude},n=Object(oe.getDistance)(p,a),r=n>1e3?"warning":"impacted";return{key:t,no:t+1,name:e.attributes.PomName,distance:n/1e3,distanceNumber:n,status:r,group:e.attributes.GroupName,kabupaten:e.attributes.Kabupaten,province:e.attributes.PROPNAME,capacity:e.attributes.Tankcap,company:e.attributes.CompanyNam}}));f.sort((function(e,t){return e.distanceNumber-t.distanceNumber}));var y=d.map((function(e,t){return{key:t,acq_date:e.attributes.Loc_Date,latitude:e.attributes.Latitude,longitude:e.attributes.Longitude,verification:e.attributes.Verificati}}));console.log("dataHotspot",y);var v=u.map((function(e,t){return r.load().then((function(){var l,s=new i({wkid:3857}),c=r.project(o.dfrsArea,s),u=r.project(e.geometry,s),m=a.distance(c,u),d=m<10?"impacted":"warning",p=a.intersects(c,u);if(console.log("intersect",p),p){var f=a.intersect(c,u);l=a.geodesicArea(f,"hectares")}else l="";return{key:t,no:t+1,name:n.toTitleCase(e.attributes.Name),distance:(m/1e3).toFixed(2),status:d,group:e.attributes.GroupName,province:e.attributes.Province,totalArea:e.attributes.Total_Ha,totalImpacted:isNaN(l)?"":parseFloat(l).toFixed(3)}}))})),g=m.map((function(e,t){return console.log("el",e),r.load().then((function(){var n=new i({wkid:3857}),l=r.project(o.dfrsArea,n),s=r.project(e.geometry,n),c=a.distance(l,s),u=c<1e3?"impacted":"warning";return{remark:e.attributes.Category,area:e.attributes["SHAPE.STArea()"].toFixed(2),key:t,status:u,distance:(c/1e3).toFixed(2)}}))}));Promise.all(v).then((function(e){return n.setState({concData:e})})),Promise.all(g).then((function(e){return n.setState({peatData:e})})),n.setState({hotspotData:y,pomData:f})}))},n.state={pomData:[],concData:[],peatData:[],hotspotData:[]},n}return Object(M.a)(a,[{key:"toTitleCase",value:function(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}},{key:"componentDidMount",value:function(){this.processingData()}},{key:"render",value:function(){var e=this.state,t=e.pomData,a=e.concData,n=e.peatData,i=e.hotspotData;return r.a.createElement("div",{style:{height:"60vh",overflow:"scroll",paddingLeft:"5vw",paddingRight:"5vw"}},r.a.createElement("h2",null,"Mill - Third Party Supplier"),r.a.createElement(z.a,{id:"pomTable",dataSource:t,columns:ce}),r.a.createElement(f.a,null),r.a.createElement("h2",null,"Concession"),r.a.createElement(z.a,{dataSource:a,columns:ue}),r.a.createElement(f.a,null),r.a.createElement("h2",null,"Peat"),r.a.createElement(z.a,{dataSource:n,columns:me}),r.a.createElement(f.a,null),r.a.createElement("h2",null,"Hotspot"),r.a.createElement(z.a,{dataSource:i,columns:de}),r.a.createElement(f.a,null),r.a.createElement(c.a,{type:"dashed",onClick:this.generatePdf},"Export to PDF"),r.a.createElement(f.a,null))}}]),a}(r.a.Component),fe=(Object(H.loadModules)(["esri/Map","esri/views/MapView","esri/layers/VectorTileLayer","esri/widgets/BasemapGallery","esri/widgets/Expand","esri/widgets/LayerList","esri/layers/FeatureLayer","esri/layers/GroupLayer","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/Legend","esri/geometry/geometryEngine","esri/core/watchUtils","esri/widgets/DistanceMeasurement2D","esri/tasks/support/Query","esri/widgets/TimeSlider","esri/widgets/Zoom","esri/geometry/projection","esri/geometry/SpatialReference"],{css:!0}).then((function(e){var t=Object(l.a)(e,19);return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15],t[16],t[17],t[18]]})),a(491)),ye=(new le.default({orientation:"landscape"}),"http://10.7.12.21:8000/service/WGService.asmx/"),ve=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(e,n){var i;return Object(O.a)(this,a),(i=t.call(this,e,n)).f_showDrawer=function(e){i.setState({isDrawerShow:e})},i.f_dfrsFormOnFinish=function(e,t){var a,n;if("range-picker"==t){var r=e["range-picker"][0].format("YYYY-MM-DD"),o=e["range-picker"][1].format("YYYY-MM-DD");a="start_date >= date'".concat(r,"' and end_date <= date'").concat(o,"'"),n=[r,o]}else if("period"==t){var s=e["period-time"].split("|"),c=Object(l.a)(s,2),u=c[0],m=c[1];a="end_date >= date'".concat(u,"' and end_date <= date'").concat(m,"'"),n=[u,m]}else if("all"==t)a="",n=[];else if("todate"==t){var d=Object(l.a)(i.f_getDatesRange(b()("20190215"),b()())[0],2),p=d[0],f=d[1];a="end_date >= date'".concat(p,"' and end_date <= date'").concat(f,"'"),n=[p,f]}i.setState({timeSelection:n});var y=i.layerDeforestationPoint.createQuery();y.where=a,i.layerDeforestationArea.queryFeatures(y).then((function(e){return i.setState({dfrsResult:e.features})})),i.layerDeforestationPoint.definitionExpression=a,i.layerDeforestationPoint.visible=!0},i.f_zoomTo=function(e){i.view.goTo({target:e.geometry,tilt:70}),i.view.whenLayerView(i.layerDeforestationArea).then((function(t){var a=i.layerDeforestationArea.createQuery();a.where="id = '".concat(e.attributes.id,"'"),i.layerDeforestationArea.queryFeatures(a).then((function(e){console.log("rf",e.features),i.highlightArea&&i.highlightArea.remove(),i.highlightArea=t.highlight(e.features)}))}))},i.f_fetchTimeDfrs=function(){fetch("https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Deforestation/MapServer/0/query?f=json&outFields=[start_date,end_date]&where=1=1&returnGeometry=false").then((function(e){return e.json()})).then((function(e){return i.setState({timedata:e.features})}))},i.f_clearBufferLayers=function(){i.bufferLayer.removeAll()},i.f_onClear=function(){i.setState({dfrsResult:[]}),i.layerDeforestationPoint.visible=!1},i.f_hotspot=function(){},i.f_downloadPdf=function(){console.log("data to pdf",i.state.dfrsResult)},i.mapRef=r.a.createRef(),i.state={isDrawerShow:!1,dfrsResult:[],timedata:[],showModal:!1,modalData:[],isLoading:!1,dfrsPointGeom:[],dfrsAreaGeom:null,timeSelection:[]},i.theme={dark:"https://js.arcgis.com/4.16/esri/themes/dark/main.css",light:!0},i.f_fetchTimeDfrs(),i}return Object(M.a)(a,[{key:"f_getDatesRange",value:function(e,t){for(var a=e,n=[];a<=t;){var r=a.format(),i=a.add(13,"days").format();n.push([r,i]),a=a.add(1,"days")}return n.reverse()}},{key:"componentDidMount",value:function(){var e=this;Object(H.loadModules)(["esri/Map","esri/views/MapView","esri/layers/VectorTileLayer","esri/widgets/BasemapGallery","esri/widgets/Expand","esri/widgets/LayerList","esri/layers/FeatureLayer","esri/layers/GroupLayer","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/Legend","esri/geometry/geometryEngine","esri/core/watchUtils","esri/widgets/DistanceMeasurement2D","esri/tasks/support/Query","esri/widgets/TimeSlider","esri/widgets/Zoom","esri/geometry/projection","esri/geometry/SpatialReference"],{css:this.theme.light}).then((function(t){var a=Object(l.a)(t,19),i=a[0],s=a[1],u=a[2],m=a[3],d=a[4],p=a[5],y=a[6],v=a[7],h=a[8],E=a[9],w=a[10],k=a[11],D=a[12],P=(a[13],a[14]),j=a[15],S=a[16],O=a[17],M=a[18],C=function(t){for(var a=Object(n.useState)(!1),i=Object(l.a)(a,2),o=i[0],s=i[1],u=t.data,m=[],d=0,p=Object.keys(u);d<p.length;d++){var y=p[d];m.push(r.a.createElement(B.a.Item,{label:y,key:y},u[y]))}var v=function(t,a,n,r){var i;"Refinery"===a?(i="".concat(ye,"_GetPOMSupplier_?refinery=").concat(t),e.layerPom.visible=!0):"POM"===a&&(i="".concat(ye,"_GetRefinery_?pom=").concat(t),e.layerRefinery.visible=!0),fetch(i).then((function(e){return e.json()})).then((function(t){var a={type:"simple-line",color:[226,119,40],width:2};t.map((function(t){var i={type:"polyline",paths:[[n,r],[parseFloat(t.X_Coor),parseFloat(t.Y_Coor)]]},o=new h({geometry:i,symbol:a});e.view.graphics.add(o)}))})).then((function(){return s(!0)})).catch((function(e){return console.log("error",e)}))},g=function(){e.view.graphics.removeAll(),e.layerRefinery.visible=!1,s(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,{title:t.title,style:{fontSize:"12px"},bordered:!0,column:1,size:"small"},m),r.a.createElement(f.a,null),function(){switch(t.title){case"POM":return o?r.a.createElement(c.a,{type:"primary",onClick:g,danger:!0},"Clear"):r.a.createElement(c.a,{type:"primary",onClick:function(){return v(u.pomid,t.title,t.position.longitude,t.position.latitude)}},"Trace");case"Refinery":return 1==o?r.a.createElement(c.a,{type:"primary",onClick:g,danger:!0},"Clear"):r.a.createElement(c.a,{type:"primary",onClick:function(){return v(u.rfid,t.title,t.position.longitude,t.position.latitude)}},"Trace")}}())},I=function(t){console.log("props",t),e.layerPlantationArea.queryFeatures().then((function(e){return console.log("conc area",e)}));var a=Object(n.useState)(0),i=Object(l.a)(a,2),o=i[0],s=i[1],u=Object(n.useState)([]),m=Object(l.a)(u,2),d=m[0],p=m[1],y=Object(n.useState)([]),v=Object(l.a)(y,2),E=v[0],w=v[1],D=[{label:"POM",value:e.layerPom,key:"1"},{label:"Reffinery",value:e.layerRefinery,key:"2"},{label:"Concession Area",value:e.layerPlantationArea,key:"3"},{label:"Peatland",value:e.layerPeat,key:"4"}],j=function(e){e.target.value.visible=e.target.checked,C()},S=function(e){s(e),t.onSliderChange(e),C()},C=function(){D.forEach((function(a,n){var r=a.value;"POM Supplier"==r.title?r.visible?_(r).then((function(e){return p(e.features)})):p([]):"Oil Palm Area"==r.title&&(r.visible?_(r).then(function(){var a=Object(G.a)(N.a.mark((function a(n){var r,i,o;return N.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(r=e.layerDeforestationArea.createQuery()).where="id = '".concat(t.id,"'"),a.next=4,e.layerDeforestationArea.queryFeatures(r);case 4:return i=a.sent,a.next=7,n.features.map(function(){var e=Object(G.a)(N.a.mark((function e(t){var a,n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.next=3,I(t.geometry,i.features[0].geometry);case 3:return n=e.sent,a.area=n.area,a.intersectGeometry=n.geometry,console.log("f",a),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:o=a.sent,Promise.all(o).then((function(e){return w(e)}));case 9:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()):w([]))}))},I=function(e,t){return O.load().then((function(){var a=new M({wkid:3857}),n=O.project(e,a),r=O.project(t,a);if(k.intersects(n,r)){var i=k.intersect(r,n);console.log("intersect area",i);var o={area:k.geodesicArea(i,"hectares"),geometry:i}}else o="";return o}))},_=function(t){var a=void 0!==e.bufferLayer.graphics.getItemAt(0)&&e.bufferLayer.graphics.getItemAt(0).geometry,n=new P;return n.geometry=a,n.spatialRelationship="intersects",n.returnGeometry=!0,t.queryFeatures(n)},A=function(t,a){console.log("record",a),e.view.goTo({target:t,tilt:70})},x=function(t,a){console.log("data",t);var n=[{title:"Name",dataIndex:"name",key:"name",render:function(e){return r.a.createElement("a",null,e)}},{title:"Action",dataIndex:"action",key:"action",render:function(e,t){return console.log("re",t),r.a.createElement(c.a,{onClick:function(){return A(e.geometry,t)}},"go to")}}],i=[{title:"Names",dataIndex:"name",key:"name",render:function(e){return r.a.createElement("a",null,e)}},{title:"Impacted Area",dataIndex:"area",key:"area",render:function(e){return isNaN(parseFloat(e).toFixed(3))?null:r.a.createElement("span",{style:{color:"red"}},parseFloat(e).toFixed(3)," Ha")}},{title:"Action",dataIndex:"action",key:"action",render:function(t,a){return void 0===a.area?r.a.createElement(c.a,{onClick:function(){return A(t.geometry,a)}},"go to"):r.a.createElement(g.a,null,r.a.createElement(c.a,{onClick:function(){return A(t.geometry,a)}},"go to"),r.a.createElement(c.a,{onClick:function(){return function(t){e.layerIntersectPolygon.removeAll();var a=new h({geometry:t,symbol:{type:"simple-fill",color:[227,139,79,.8],outline:{color:[255,255,255],width:1}}});e.layerIntersectPolygon.add(a),e.view.goTo({target:t,tilt:70})}(t.intersectGeometry)}},"impacted"))}}],o={POM:"PomName",Concession:"Name"};if(t.length>0){console.log(t);var l=t.map((function(e){return{name:e.attributes[o[a]],action:e,area:e.area,intersectGeometry:e.intersectGeometry}}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,a),r.a.createElement("div",{style:{padding:"10px"}},r.a.createElement(z.a,{columns:"POM"==a?n:"Concession"==a?i:void 0,dataSource:l,size:"small"})),r.a.createElement(f.a,null))}return null};return r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,{title:"Detail",column:1,bordered:!0},r.a.createElement(B.a.Item,{label:"Start"},b()(t.attributes.start_date).format("DD/MM/YYYY")),r.a.createElement(B.a.Item,{label:"End"},b()(t.attributes.end_date).format("DD/MM/YYYY")),r.a.createElement(B.a.Item,{label:"Total Area"},t.attributes.total," ha")),r.a.createElement(f.a,null),r.a.createElement("h4",null,"Buffer Radius in Kilometers"),r.a.createElement("div",{style:{position:"relative"}},r.a.createElement(q.a,null,r.a.createElement(K.a,{span:17},r.a.createElement(V.a,{defaultValue:o,max:50,value:"number"===typeof o?o:0,tooltipPlacement:"bottom",onChange:S})),r.a.createElement(K.a,{span:2},r.a.createElement(U.a,{min:0,max:50,style:{margin:"0 16px"},value:o,onChange:S}))),r.a.createElement(f.a,null),r.a.createElement("h4",null,"Show or hide layer"),D.map((function(e){return r.a.createElement(W.a,{key:e.key,value:e.value,onChange:j},e.label)})),r.a.createElement(f.a,null),x(d,"POM"),x(E,"Concession")),r.a.createElement("div",{style:{position:"sticky",bottom:"0px"}},r.a.createElement(g.a,null,r.a.createElement(c.a,{type:"primary",onClick:function(){var a=void 0!==e.bufferLayer.graphics.getItemAt(0)&&e.bufferLayer.graphics.getItemAt(0).geometry;if(a){var n=new P;n.geometry=a,n.spatialRelationship="intersects",n.returnGeometry=!0,n.outFields="*",n.outSpatialReference={wkid:4326};var r=new P;r.outFields="*",r.returnGeometry=!0,r.where="id = '".concat(t.id,"'");var i=new P;i.outFields="*",i.geometry=a,i.returnGeometry=!0,i.spatialRelationship="intersects",i.where="Acq_Date between date'".concat(b()(t.attributes.start_date).format("YYYY-MM-DD"),"' and '").concat(b()(t.attributes.end_date).format("YYYY-MM-DD"),"'"),e.layerDeforestationArea.queryFeatures(r).then((function(t){e.setState({dfrsAreaGeom:t.features[0].geometry})})),e.setState({isLoading:!0}),Promise.all([e.layerPom.queryFeatures(n),e.layerPlantationArea.queryFeatures(n),e.layerPeat.queryFeatures(n),e.layerHotspot.queryFeatures(i)]).then((function(t){var a=t.map((function(e){return e.features}));console.log("fs",a),e.setState({modalData:a})})).then((function(){return e.setState({showModal:!0,isLoading:!1})}))}}},"Show List"))))},_=function(t,a){console.log(t,a);var n=document.createElement("div");if("POM"===a)Q.content=n,o.a.render(r.a.createElement(C,{data:t.graphic.attributes,title:a,position:{latitude:t.graphic.geometry.latitude,longitude:t.graphic.geometry.longitude}}),n);else if("Deforestation Point"===a||"Deforestation Area"===a){ee.content=n;o.a.render(r.a.createElement(I,{id:t.graphic.attributes.id,onSliderChange:function(a){var n=t.graphic.geometry;e.setState({dfrsPointGeom:n}),function(t,a){if(a>0){var n=k.geodesicBuffer(t,a,"kilometers");0===e.bufferLayer.graphics.length?e.bufferLayer.add(new h({geometry:n,symbol:{type:"simple-fill",color:[140,140,222,.5],outline:{color:[0,0,0,.5],width:2}}})):e.bufferLayer.graphics.getItemAt(0).geometry=n}else e.bufferLayer.removeAll()}(n,a)},attributes:t.graphic.attributes}),n)}else Q.content=n,o.a.render(r.a.createElement(C,{data:t.graphic.attributes,title:a,position:{latitude:t.graphic.geometry.latitude,longitude:t.graphic.geometry.longitude}}),n);return n};e.map=new i({basemap:"streets-night-vector"}),e.view=new s({container:e.mapRef.current,map:e.map,center:[118,0],zoom:4,popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,breakpoint:!1,position:"top-left"}}}),e.layerPlantationPoint=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/OilPalm_Plantation_TP_Supplier/MapServer/0",title:"Oil Palm Plantation",visible:!1,outFields:["*"]}),e.layerPlantationArea=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Third_Party_Supplier/MapServer/2",title:"Oil Palm Area",visible:!1,outFields:["*"]}),e.layerPeat=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Layer_Fungsi_Ekosistem_Gambut_201907_sde/MapServer/0",title:"Peat Ecosystem",visible:!1,outFields:["*"]}),e.layerPkCrushing=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/industries_MIL1/MapServer/0",title:"3rd PK Crushing",visible:!1}),e.layerRefinery=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Layer_Refinery_201908_sde/MapServer/0",title:"Refinery",visible:!1,popupEnabled:!0,outFields:["*"]}),e.layerPom=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Third_Party_Supplier_2020/MapServer/1",title:"3rd Party Mill",visible:!1,popupEnabled:!0,outFields:["pomid","PomName","CompanyNam","PlaceName","Tankcap","Silocap"]}),e.layerDeforestationPoint=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Deforestation/MapServer/0",title:"Deforestation Point",visible:!1,popupEnabled:!0,outFields:["*"]}),e.map.add(e.layerDeforestationPoint),e.layerDeforestationArea=new y({url:"https://gisportal.wilmar.co.id/arcgisserver/rest/services/third_party/deforestation_builder/MapServer/0",title:"Deforestation Area",visible:!1,outFields:["*"]});new u({url:"https://gisportal.wilmar.co.id/arcgisserver/rest/services/Hosted/Wilmar_Basemap2/VectorTileServer?f=pjson"});e.layerHotspot=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Hotspot_HSP1/MapServer/0",title:"Hotspot",visible:!1,outFields:["*"]}),e.map.add(e.layerHotspot),e.sketchLayer=new E({listMode:"hide"}),e.bufferLayer=new E({listMode:"hide"}),e.map.addMany([e.sketchLayer,e.bufferLayer]);var A=new v({title:"Wilmar Third Party"}),x=(new v({title:"Plantation"}),new v({title:"Deforestation"})),T=new v({title:"Land Issue"});A.addMany([e.layerRefinery,e.layerPom,e.layerPkCrushing,e.layerPlantationArea,e.layerPlantationPoint]),x.addMany([e.layerDeforestationArea,e.layerDeforestationPoint]),T.addMany([e.layerPeat]),e.map.addMany([A,x,T]),e.layerIntersectPolygon=new E({title:"intersected"}),e.map.add(e.layerIntersectPolygon);var F=new S({view:e.view});e.view.ui.components=[],e.view.ui.add(F,"top-right");var L=new m({view:e.view}),Y=new d({view:e.view,content:L,expandTooltip:"Change Basemap"});e.view.ui.add(Y,"top-right");var R=new p({view:e.view}),H=new d({view:e.view,content:R,expandTooltip:"Layer List"});e.view.ui.add(H,"top-right");var J=new w({view:e.view});e.view.ui.add(J,"bottom-right");new j({container:"timeSlider",playRate:50,stops:{interval:{value:1,unit:"hours"}}});var Q={title:"POM Suplier",content:function(e){return _(e,"POM")}};e.layerPom.popupTemplate=Q;var Z={title:"Refinery",content:function(e){return _(e,"Refinery")}};e.layerRefinery.popupTemplate=Z;var X={title:"Concession Area",content:function(e){return _(e,"Concession Area")}};e.layerPlantationArea.popupTemplate=X;var $={title:"Hotspot",content:function(e){return _(e,"Hotspot")}};e.layerHotspot.popupTemplate=$;var ee={title:"Deforestation Point",content:function(e){return _(e,"Deforestation Point")}};e.layerDeforestationPoint.popupTemplate=ee;var te={title:"Deforestation Area",content:function(e){return _(e,"Deforestation Area")}};e.layerDeforestationArea.popupTemplate=te,e.view.when((function(){return e.view.whenLayerView(e.layerIntersectPolygon).then((function(t){e.view.on("pointer-move",(function(t){if(void 0!==e.layerIntersectPolygon.graphics.getItemAt(0)){var a={x:t.x,y:t.y};e.view.hitTest(a).then((function(e){e.results.forEach((function(e){"intersected"==e.graphic.layer.title&&console.log("elelee",e)}))}))}}))}))})),D.whenTrue(e.view,"stationary",(function(){e.view.zoom>=10?(console.log(e.view.zoom),e.layerDeforestationArea.visible=!!e.layerDeforestationPoint.visible):e.layerDeforestationArea.visible=!1}))}))}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillMount",value:function(){this.view&&(this.view.container=null)}},{key:"render",value:function(){var e,t=this;if(null==this.state.dfrsResult)e=r.a.createElement(J.a,{title:"Please choose date range"});else if(0==this.state.dfrsResult.length)e=r.a.createElement(Q.a,null);else{var a=[],n=["IDN_w0tv4g7_20200908","IDN_w0tv675_20200908","IDN_w0tv5sw_20200908","IDN_w0sxfr1_20200901","\tIDN_w0u8138_20200906"];this.state.dfrsResult.map((function(e,r){var i={key:r,lat:e.attributes.POINT_X,lon:e.attributes.POINT_Y,startdate:e.attributes.start_date,enddate:e.attributes.end_date,peatland:e.attributes.peatland,mangrove:e.attributes.mangrove,other:e.attributes.other,total:e.attributes.total,zoomTo:function(){return t.f_zoomTo(e)},impacted:!!n.includes(e.attributes.id)},o=n.includes(e.attributes.id)?1:0;a.push({sorter:o,data:i})}));var i=fe.orderBy(a,["sorter"],["desc"]);console.log(i);var o=fe.map(i,(function(e,t){var a=Object(S.a)(Object(S.a)({},e.data),{},{index:t+1});return r.a.createElement(re,{key:a.key,lat:a.lat,lon:a.lon,startdate:a.startdate,enddate:a.enddate,peatland:a.peatland,mangrove:a.mangrove,other:a.other,total:a.total,index:a.index,zoomTo:a.zoomTo,impacted:a.impacted})}));e=r.a.createElement(g.a,{direction:"vertical"},o)}return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"webmap",ref:this.mapRef}),r.a.createElement("div",{className:"spinner"},r.a.createElement(Z.a,{spinning:this.state.isLoading,size:"large",tip:"Loading..."})),r.a.createElement(D,{onClick:function(){return t.f_showDrawer(!0)},count:4}),r.a.createElement(ee,{onClick:this.f_clearBufferLayers}),r.a.createElement(ae,{className:"button-hotspot",onClick:function(){return t.layerHotspot.visible=!t.layerHotspot.visible}}),r.a.createElement(u.a,{title:"Deforestation",placement:"right",closable:!0,onClose:function(){return t.f_showDrawer(!1)},visible:this.state.isDrawerShow,width:500},r.a.createElement(k,{timesRange:this.f_getDatesRange(b()("20190215"),b()()),onFinish:this.f_dfrsFormOnFinish,onClear:this.f_onClear}),r.a.createElement(f.a,null),this.state.dfrsResult.length>0?r.a.createElement(c.a,{onClick:this.f_downloadPdf,block:!0},"Download PDF"):null,r.a.createElement(f.a,null),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},e)),r.a.createElement(X.a,{title:"Detail",visible:this.state.showModal,onOk:function(e){return t.setState({showModal:!1})},onCancel:function(e){return t.setState({showModal:!1})},width:"80vw",destroyOnClose:!0},r.a.createElement(pe,{data:this.state.modalData,location:this.state.dfrsPointGeom,dfrsArea:this.state.dfrsAreaGeom})))}}]),a}(r.a.Component);ve.contextType=_;var ge=ve,he=a(644),be=function(e){return r.a.createElement(he.a,{value:e.value})},Ee=a(46),we=[{name:"Have Plantation",value:310},{name:"Not have Plantation",value:190}],ke=["#0088FE","#00C49F","#FFBB28","#FF8042"],De=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(M.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ee.f,{width:400,height:400},r.a.createElement(Ee.e,{dataKey:"value",isAnimationActive:!1,data:we,cx:200,cy:200,outerRadius:100,fill:"#8884d8",innerRadius:60,label:!0},we.map((function(e,t){return r.a.createElement(Ee.d,{fill:ke[t%ke.length]})}))),r.a.createElement(Ee.g,null)))}}]),a}(n.PureComponent);De.jsfiddleUrl="https://jsfiddle.net/alidingling/k9jkog04/";var Pe=[{name:"Peat Area",value:290},{name:"Peat Loss",value:10}],je=["#FFBB28","#FF8042"];(function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(M.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ee.f,{width:400,height:400},r.a.createElement(Ee.e,{dataKey:"value",isAnimationActive:!1,data:Pe,cx:200,cy:200,outerRadius:100,fill:"#8884d8",innerRadius:60,label:!0},Pe.map((function(e,t){return r.a.createElement(Ee.d,{fill:je[t%je.length]})}))),r.a.createElement(Ee.g,null)))}}]),a}(n.PureComponent)).jsfiddleUrl="https://jsfiddle.net/alidingling/k9jkog04/";var Se=[{name:"Jan",area:1.2},{name:"Feb",area:2.2},{name:"Mar",area:3.2},{name:"Apr",area:2.9},{name:"May",area:2.2},{name:"June",area:1.9},{name:"Jul",area:2},{name:"Aug",area:.5},{name:"Sep",area:.6},{name:"Oct",area:.2},{name:"Nov",area:1.1},{name:"Dec",area:1.3}],Oe=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(M.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ee.b,{width:900,height:100,data:Se,margin:{top:20,left:20,bottom:20,right:20}},r.a.createElement(Ee.c,{strokeDasharray:"3 3"}),r.a.createElement(Ee.h,{dataKey:"name"}),r.a.createElement(Ee.i,null),r.a.createElement(Ee.g,null),r.a.createElement(Ee.a,{type:"monotone",dataKey:"area",stroke:"#8884d8",fill:"#8884d8"})))}}]),a}(n.PureComponent);Oe.jsfiddleUrl="https://jsfiddle.net/alidingling/Lrffmzfc/";var Me=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(M.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"dashboard-wrapper"},r.a.createElement(q.a,null,r.a.createElement(K.a,{span:8},r.a.createElement("div",{style:{height:"45vh"}},r.a.createElement(ne.a,{title:"Total Cover Loss(Ha)",style:{height:"50%"}},r.a.createElement(be,{value:12e3})),r.a.createElement(ne.a,{title:"Total Cover Loss(Ha)",style:{height:"50%"}},r.a.createElement(be,{value:12e3})))),r.a.createElement(K.a,{span:16},r.a.createElement("div",{style:{height:"45vh"}},r.a.createElement(ne.a,{title:"Deforestation by Month",style:{height:"100%"}},r.a.createElement(Oe,null))))),r.a.createElement(q.a,{style:{height:"45vh"}},r.a.createElement(K.a,{span:8},r.a.createElement("div",{style:{maxHeight:"45vh"}},r.a.createElement(ne.a,{title:"Concession Ratio",style:{height:"100%"}},r.a.createElement(De,null)))),r.a.createElement(K.a,{span:8},r.a.createElement("div",{style:{maxHeight:"50vh"}},r.a.createElement(ne.a,{title:"Concession Ratio",style:{height:"100%"}},r.a.createElement(De,null)))),r.a.createElement(K.a,{span:8},r.a.createElement("div",{style:{maxHeight:"50vh"}},r.a.createElement(ne.a,{title:"Concession Ratio",style:{height:"100%"}},r.a.createElement(De,null))))))}}]),a}(r.a.Component),Ce=(a(626),j.a.Content);var Ie=function(){return r.a.createElement(T,null,r.a.createElement(j.a,{style:{minHeight:"100vh"}},r.a.createElement(Y,null),r.a.createElement(j.a,{className:"site-layout"},r.a.createElement(Ce,{style:{margin:"0 0px"}},r.a.createElement("div",{className:"site-layout-background",style:{minHeight:"100vh"}},r.a.createElement(x,null,(function(e){return"dashboard"==e.activePage?r.a.createElement(Me,null):"map"==e.activePage?r.a.createElement(ge,null):void 0})))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[356,1,2]]]);
//# sourceMappingURL=main.b4292df2.chunk.js.map