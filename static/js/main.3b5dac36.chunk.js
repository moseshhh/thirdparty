(this.webpackJsonpthird_party=this.webpackJsonpthird_party||[]).push([[0],{357:function(e,t,a){e.exports=a(627)},362:function(e,t,a){},626:function(e,t,a){},627:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(19),o=a.n(i),l=(a(362),a(39)),s=a(645),c=a(56),u=a(643),d=a(649),m=a(640),p=a(174),f=a(634),y=a(638),v=a(136),g=a(635),h=a(37),b=a.n(h),E={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},w={xs:{span:24,offset:0},sm:{span:16,offset:8}},k=function(e){var t=Object(r.useState)(!0),a=Object(l.a)(t,2),i=a[0],o=a[1],s=Object(r.useState)(!0),u=Object(l.a)(s,2),d=u[0],h=u[1],k=Object(r.useState)("todate"),D=Object(l.a)(k,2),P=D[0],M=D[1];var S=e.timesRange;return n.a.createElement(m.a,Object.assign({name:"deforestation_control"},E,{onFinish:function(t){return e.onFinish(t,P)}}),n.a.createElement(p.a.Group,{onChange:function(e){M(e.target.value),"period"==e.target.value?(h(!1),o(!0)):"range-picker"==e.target.value?(h(!0),o(!1)):("all"==e.target.value||"todate"==e.target.value)&&(h(!0),o(!0))},value:P},n.a.createElement(p.a,{value:"todate"},"To Date"),n.a.createElement(p.a,{value:"range-picker"},"Time Range"),n.a.createElement(p.a,{value:"period"},"Time Period"),n.a.createElement(p.a,{value:"all"},"Select All")),n.a.createElement(f.a,null),n.a.createElement(m.a.Item,{name:"range-picker",label:"Time Range"},n.a.createElement(y.a.RangePicker,{format:"YYYY/MM/DD",disabled:i})),n.a.createElement(f.a,null,"Or"),n.a.createElement(m.a.Item,{name:"period-time",label:"Period Time"},n.a.createElement(v.a,{placeholder:"select time period",disabled:d},S.map((function(e,t){var a=Object(l.a)(e,2),r=a[0],i=a[1];return n.a.createElement(v.a.Option,{key:t,value:"".concat(b()(r).format("YYYY-MM-DD"),"|").concat(b()(i).format("YYYY-MM-DD"))},b()(r).format("MMM Do YYYY")," - ",b()(i).format("MMM Do YYYY"))})))),n.a.createElement(m.a.Item,{wrapperCol:w},n.a.createElement(g.a,null,n.a.createElement(c.a,{type:"primary",htmlType:"submit",id:"button-form-deforestation"},"Submit"),n.a.createElement(c.a,{type:"primary",onClick:e.onClear},"Clear"))))},D=function(e){var t=Object(r.useState)(!1),a=Object(l.a)(t,2),i=a[0],o=a[1];return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"button-notif"},n.a.createElement(s.a,{count:e.count},n.a.createElement(c.a,{type:"primary",shape:"circle",size:"large",id:"buttonNotif",onClick:e.onClick},n.a.createElement(d.a,null)))),n.a.createElement(u.a,{title:"Deforestation",placement:"right",closable:!0,onClose:function(){o(!1)},visible:i,width:500}))},P=a(105),M=a(636),S=a(124),j=a(50),O=a(51),C=a(53),I=a(52),x=n.a.createContext(),_=x.Provider,A=x.Consumer,F=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){var e;Object(j.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).state={activePage:"map"},e.f_setActivePage=function(t){e.setState({activePage:t})},e}return Object(O.a)(a,[{key:"render",value:function(){return n.a.createElement(_,{value:Object(S.a)(Object(S.a)({},this.state),{},{f_setActivePage:this.f_setActivePage})},this.props.children)}}]),a}(n.a.Component),Y=a(650),T=a(651),L=(P.a.SubMenu,function(e){var t=Object(r.useContext)(x),a=Object(r.useState)(!0),i=Object(l.a)(a,2),o=i[0];i[1];return n.a.createElement(M.a.Sider,{collapsed:o},n.a.createElement("div",{className:"logo"}),n.a.createElement(P.a,{theme:"dark",onClick:function(e){t.f_setActivePage(e.key)},defaultSelectedKeys:[t.activePage],mode:"inline"},n.a.createElement(P.a.Item,{key:"dashboard",icon:n.a.createElement(Y.a,null)}),n.a.createElement(P.a.Item,{key:"map",icon:n.a.createElement(T.a,null)},"Maps")))}),R=a(139),N=a.n(R),G=a(217),B=a(116),H=a(646),z=a(637),q=a(125),U=a(70),K=a(641),V=a(648),W=a(138),J=a(647),Q=a(88),Z=a(308),X=a(642),$=a(652),ee=function(e){var t=Object(r.useState)(!1),a=Object(l.a)(t,2),i=a[0],o=a[1];return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"button-clear"},n.a.createElement(s.a,{count:e.count},n.a.createElement(c.a,{type:"primary",shape:"circle",size:"large",id:"buttonClear",onClick:e.onClick},n.a.createElement($.a,null)))),n.a.createElement(u.a,{title:"Deforestation",placement:"right",closable:!0,onClose:function(){o(!1)},visible:i,width:500}))},te=a(653),ae=function(e){return n.a.createElement("div",{className:e.className},n.a.createElement(c.a,{type:"primary",shape:"circle",size:"large",id:"buttonClear",onClick:e.onClick,danger:!0},n.a.createElement(te.a,null)))},re=a(639),ne=function(e){var t=e.impacted?{backgroundColor:"red"}:null;return n.a.createElement(re.a,{type:"inner",title:"Deforestation ".concat(e.index),headStyle:t,extra:n.a.createElement(c.a,{type:"dashed",onClick:e.zoomTo},"Zoom to")},n.a.createElement(H.a,{size:"small",layout:"vertical"},n.a.createElement(H.a.Item,{label:"Latitude"},e.lat),n.a.createElement(H.a.Item,{label:"Longitude"},e.lon),n.a.createElement(H.a.Item,{label:"Start Date"},b()(new Date(e.startdate)).format("yyyy/MM/DD")),n.a.createElement(H.a.Item,{label:"End Date"},b()(new Date(e.enddate)).format("yyyy/MM/DD")),n.a.createElement(H.a.Item,{label:"Peatland"},e.peat," ha"),n.a.createElement(H.a.Item,{label:"Concession"},e.konsesi," ha"),n.a.createElement(H.a.Item,{label:"Other"},e.other," ha"),n.a.createElement(H.a.Item,{label:"Total"},e.total," ha")))},ie=a(329),oe=a(300),le=(a(480),a(131)),se=(a(252),a(253)),ce=new le.default({orientation:"landscape"}),ue=[{title:"Pom Name",dataIndex:"name",key:"name",span:10,sorter:function(e,t){return e.name.localeCompare(t.name)},sortDirections:["ascend"]},{title:"Company",dataIndex:"company",key:"company",span:10},{title:"Group",dataIndex:"group",key:"group",span:10},{title:"District",dataIndex:"kabupaten",key:"kabupaten",span:10},{title:"Province",dataIndex:"province",key:"province",span:10},{title:"Capacity",dataIndex:"capacity",key:"capacity",span:10},{title:"Distance (estimation) in Km",dataIndex:"distance",key:"distance",span:10,sorter:function(e,t){return e.distance-t.distance}},{title:"Status",dataIndex:"status",key:"status",span:10,render:function(e){var t="warning"==e?"yellow":"red";return n.a.createElement(ie.a,{color:t,key:e},e)}}],de=[{title:"Concession",dataIndex:"name",key:"name",span:10},{title:"Group",dataIndex:"group",key:"groupe",span:10},{title:"Province",dataIndex:"province",key:"provincee",span:10},{title:"Total Area",dataIndex:"totalArea",key:"totalArea",span:10},{title:"Impacted",dataIndex:"totalImpacted",key:"totalImpacted",span:10},{title:"Distance in Km (Estimation)",dataIndex:"distance",key:"distance",span:10,sorter:function(e,t){return e.distance-t.distance}},{title:"Status",dataIndex:"status",key:"status",span:10,render:function(e){var t="warning"==e?"yellow":"red";return n.a.createElement(ie.a,{color:t,key:e},e)}}],me=[{title:"Remarks",dataIndex:"remark",key:"remark",span:10},{title:"Status",dataIndex:"status",key:"status",span:10},{title:"Total Area",dataIndex:"area",key:"area",span:10}],pe=[{title:"Latitude",dataIndex:"latitude",key:"latitude",span:10},{title:"Longitude",dataIndex:"longitude",key:"longitude",span:10},{title:"Acquisition Date",dataIndex:"acq_date",key:"acq_date",span:10},{title:"Verification",dataIndex:"verification",key:"verification",span:10}],fe=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(e){var r;return Object(j.a)(this,a),(r=t.call(this,e)).generatePdf=function(){ce.text("Basic Information",14,20),ce.text("Location : 100.2854, 2.3290",14,30),ce.text("Radius : 40 Km",14,40),ce.text("Time Period : 8/28/2020 - 9/10/2020",14,50);var e=ue.map((function(e){return e.title})),t=r.state.pomData.map((function(e){return[e.name,e.company,e.group,e.kabupaten,e.province,e.capacity,e.distance,e.status]}));ce.text("3rd Party Mill",14,70),ce.autoTable({head:[e],body:t,startY:75,rowPageBreak:"auto",bodyStyles:{valign:"top"}});var a=de.map((function(e){return e.title})),n=r.state.concData.map((function(e){return[e.name,e.group,e.province,e.totalArea,e.totalImpacted,e.distance,e.status]}));ce.text("Concession",14,ce.lastAutoTable.finalY+20),ce.autoTable({head:[a],body:n,startY:ce.lastAutoTable.finalY+25,rowPageBreak:"auto",bodyStyles:{valign:"top"}});var i=me.map((function(e){return e.title})),o=r.state.peatData.map((function(e){return[e.remark,e.distance,e.area]}));ce.text("Peatland",14,ce.lastAutoTable.finalY+20),ce.autoTable({head:[i],body:o,startY:ce.lastAutoTable.finalY+25,rowPageBreak:"auto",bodyStyles:{valign:"top"}});var l=pe.map((function(e){return e.title})),s=r.state.hotspotData.map((function(e){return[e.latitude,e.longitude,e.acq_date,e.verification]}));ce.text("HotSpot",14,ce.lastAutoTable.finalY+20),ce.autoTable({head:[l],body:s,startY:ce.lastAutoTable.finalY+25,rowPageBreak:"auto",bodyStyles:{valign:"top"}}),ce.save("table.pdf")},r.processingData=function(){Object(B.loadModules)(["esri/geometry/geometryEngine","esri/geometry/projection","esri/geometry/SpatialReference"]).then((function(e){var t,a=Object(l.a)(e,3),n=a[0],i=a[1],o=a[2],s=r.props,c=Object(l.a)(s.data,4),u=c[0],d=c[1],m=c[2],p=c[3];console.log("modalcontent",s.data),"point"==s.location.type?t={latitude:s.location.latitude,longitude:s.location.longitude}:"polygon"==s.location.type&&(t={latitude:s.location.centroid.latitude,longitude:s.location.centroid.longitude});var f=u.map((function(e,a){var r={latitude:e.geometry.latitude,longitude:e.geometry.longitude};console.log("dfrs loc",t),console.log("end loc",r);var n=Object(oe.getDistance)(t,r),i=n>1e3?"warning":"impacted";return{key:a,no:a+1,name:e.attributes.PomName,distance:n/1e3,distanceNumber:n,status:i,group:e.attributes.GroupName,kabupaten:e.attributes.Kabupaten,province:e.attributes.PROPNAME,capacity:e.attributes.Tankcap,company:e.attributes.CompanyNam}}));f.sort((function(e,t){return e.distanceNumber-t.distanceNumber}));var y=p.map((function(e,t){return{key:t,acq_date:e.attributes.Loc_Date,latitude:e.attributes.Latitude,longitude:e.attributes.Longitude,verification:e.attributes.Verificati}}));console.log("dataHotspot",y);var v=d.map((function(e,t){return i.load().then((function(){var a,l=new o({wkid:3857}),c=i.project(s.dfrsArea,l),u=i.project(e.geometry,l),d=n.distance(c,u),m=d<10?"impacted":"warning",p=n.intersects(c,u);if(console.log("intersect",p),p){var f=n.intersect(c,u);a=n.geodesicArea(f,"hectares")}else a="";return{key:t,no:t+1,name:r.toTitleCase(e.attributes.Name),distance:(d/1e3).toFixed(2),status:m,group:e.attributes.GroupName,province:e.attributes.Province,totalArea:e.attributes.Total_Ha,totalImpacted:isNaN(a)?"":parseFloat(a).toFixed(3)}}))})),g=m.map((function(e,t){return console.log("el",e),i.load().then((function(){var a=new o({wkid:3857}),r=i.project(s.dfrsArea,a),l=i.project(e.geometry,a),c=n.distance(r,l),u=c<1e3?"impacted":"warning";return{remark:e.attributes.Category,area:Number(e.attributes["SHAPE.STArea()"]),key:t,status:u,distance:(c/1e3).toFixed(2)}}))}));Promise.all(v).then((function(e){return r.setState({concData:e})})),Promise.all(g).then((function(e){console.log("peat",e);var t=se.groupBy(e,"status"),a=se.groupBy(t.impacted,"remark"),n=se.groupBy(t.warning,"remark"),i=[];function o(e,t){var a=e[t],r=null;return void 0!==a&&(r=a.reduce((function(e,t){var a=e.area+t.area;return{remark:t.remark,area:a,key:1,status:t.status}})),i.push(r)),r}o(a,"Indikatif Fungsi Budidaya"),o(a,"Indikatif Fungsi Lindung"),o(n,"Indikatif Fungsi Budidaya"),o(n,"Indikatif Fungsi Lindung"),se(e).groupBy("remark").map((function(e,t){return{remark:t,area:se.sumBy(e,"area")}})).value();r.setState({peatData:i})})),r.setState({hotspotData:y,pomData:f})}))},r.state={pomData:[],concData:[],peatData:[],hotspotData:[]},r}return Object(O.a)(a,[{key:"toTitleCase",value:function(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}},{key:"componentDidMount",value:function(){this.processingData()}},{key:"render",value:function(){var e=this.state,t=e.pomData,a=e.concData,r=e.peatData,i=e.hotspotData;return n.a.createElement("div",{style:{height:"60vh",overflow:"scroll",paddingLeft:"5vw",paddingRight:"5vw"}},n.a.createElement("h2",null,"Mill - Third Party Supplier"),n.a.createElement(z.a,{id:"pomTable",dataSource:t,columns:ue}),n.a.createElement(f.a,null),n.a.createElement("h2",null,"Concession"),n.a.createElement(z.a,{dataSource:a,columns:de}),n.a.createElement(f.a,null),n.a.createElement("h2",null,"Peat"),n.a.createElement(z.a,{dataSource:r,columns:me}),n.a.createElement(f.a,null),n.a.createElement("h2",null,"Hotspot"),n.a.createElement(z.a,{dataSource:i,columns:pe}),n.a.createElement(f.a,null),n.a.createElement(c.a,{type:"dashed",onClick:this.generatePdf},"Export to PDF"),n.a.createElement(f.a,null))}}]),a}(n.a.Component),ye=(Object(B.loadModules)(["esri/Map","esri/views/MapView","esri/layers/VectorTileLayer","esri/widgets/BasemapGallery","esri/widgets/Expand","esri/widgets/LayerList","esri/layers/FeatureLayer","esri/layers/GroupLayer","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/Legend","esri/geometry/geometryEngine","esri/core/watchUtils","esri/widgets/DistanceMeasurement2D","esri/tasks/support/Query","esri/widgets/TimeSlider","esri/widgets/Zoom","esri/geometry/projection","esri/geometry/SpatialReference"],{css:!0}).then((function(e){var t=Object(l.a)(e,19);return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15],t[16],t[17],t[18]]})),a(253)),ve=new le.default({orientation:"landscape"}),ge="http://10.7.12.21:8000/service/WGService.asmx/",he=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(e,r){var i;return Object(j.a)(this,a),(i=t.call(this,e,r)).f_showDrawer=function(e){i.setState({isDrawerShow:e})},i.f_dfrsFormOnFinish=function(e,t){var a,r;if("range-picker"==t){var n=e["range-picker"][0].format("YYYY-MM-DD"),o=e["range-picker"][1].format("YYYY-MM-DD");a="start_date >= date'".concat(n,"' and end_date <= date'").concat(o,"'"),r=[n,o]}else if("period"==t){var s=e["period-time"].split("|"),c=Object(l.a)(s,2),u=c[0],d=c[1],m="".concat(b()(u).format("MMM DD, YYYY")," - ").concat(b()(d).format("MMM DD, YYYY"));a="Period = '".concat(m,"'"),r=[u,d]}else if("all"==t)a="",r=[];else if("todate"==t){var p=Object(l.a)(i.f_getDatesRange(b()("20190215"),b()())[0],2),f=p[0],y=p[1];a="end_date >= date'".concat(f,"' and end_date <= date'").concat(y,"'"),r=[f,y]}i.setState({timeSelection:r});var v=i.layerDeforestationPoint.createQuery();v.where=a,i.layerDeforestationArea.queryFeatures(v).then((function(e){return i.setState({dfrsResult:e.features})})),i.layerDeforestationPoint.definitionExpression=a,i.layerDeforestationPoint.visible=!0},i.f_zoomTo=function(e){i.view.goTo({target:e.geometry,tilt:70}),i.view.whenLayerView(i.layerDeforestationArea).then((function(t){var a=i.layerDeforestationArea.createQuery();a.where="id = '".concat(e.attributes.id,"'"),i.layerDeforestationArea.queryFeatures(a).then((function(e){console.log("rf",e.features),i.highlightArea&&i.highlightArea.remove(),i.highlightArea=t.highlight(e.features)}))}))},i.f_fetchTimeDfrs=function(){fetch("https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Deforestation/MapServer/0/query?f=json&outFields=[start_date,end_date]&where=1=1&returnGeometry=false").then((function(e){return e.json()})).then((function(e){return i.setState({timedata:e.features})}))},i.f_clearBufferLayers=function(){i.bufferLayer.removeAll()},i.f_onClear=function(){i.setState({dfrsResult:[]}),i.layerDeforestationPoint.visible=!1},i.f_hotspot=function(){},i.f_downloadPdf=function(){console.log("data to pdf",i.state.dfrsResult);var e=i.state.dfrsResult.map((function(e,t){return[t+1,e.attributes.Period,parseFloat(e.geometry.centroid.latitude).toFixed(3),parseFloat(e.geometry.centroid.longitude).toFixed(3),b()(e.attributes.start_date0).format("MMM DD, YYYY"),b()(e.attributes.end_date).format("MMM DD, YYYY"),parseFloat(e.attributes.SUM_konses/1e3).toFixed(2),parseFloat(e.attributes.SUM_peat_).toFixed(2)]}));ve.autoTable({head:[["no","period","latitude","longitude","start","end","concession","peatland"]],body:e,startY:40,rowPageBreak:"auto",bodyStyles:{valign:"top"}}),ve.save("tes.pdf")},i.mapRef=n.a.createRef(),i.state={isDrawerShow:!1,dfrsResult:[],timedata:[],showModal:!1,modalData:[],isLoading:!1,dfrsPointGeom:[],dfrsAreaGeom:null,timeSelection:[]},i.theme={dark:"https://js.arcgis.com/4.16/esri/themes/dark/main.css",light:!0},i.f_fetchTimeDfrs(),i}return Object(O.a)(a,[{key:"f_getDatesRange",value:function(e,t){for(var a=e,r=[];a<=t;){var n=a.format(),i=a.add(13,"days").format();r.push([n,i]),a=a.add(1,"days")}return r.reverse()}},{key:"componentDidMount",value:function(){var e=this;Object(B.loadModules)(["esri/Map","esri/views/MapView","esri/layers/VectorTileLayer","esri/widgets/BasemapGallery","esri/widgets/Expand","esri/widgets/LayerList","esri/layers/FeatureLayer","esri/layers/GroupLayer","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/Legend","esri/geometry/geometryEngine","esri/core/watchUtils","esri/widgets/DistanceMeasurement2D","esri/tasks/support/Query","esri/widgets/TimeSlider","esri/widgets/Zoom","esri/geometry/projection","esri/geometry/SpatialReference"],{css:this.theme.light}).then((function(t){var a=Object(l.a)(t,19),i=a[0],s=a[1],u=a[2],d=a[3],m=a[4],p=a[5],y=a[6],v=a[7],h=a[8],E=a[9],w=a[10],k=a[11],D=a[12],P=(a[13],a[14]),M=a[15],S=a[16],j=a[17],O=a[18],C=function(t){for(var a=Object(r.useState)(!1),i=Object(l.a)(a,2),o=i[0],s=i[1],u=t.data,d=[],m=0,p=Object.keys(u);m<p.length;m++){var y=p[m];d.push(n.a.createElement(H.a.Item,{label:y,key:y},u[y]))}var v=function(t,a,r,n){var i;"Refinery"===a?(i="".concat(ge,"_GetPOMSupplier_?refinery=").concat(t),e.layerPom.visible=!0):"POM"===a&&(i="".concat(ge,"_GetRefinery_?pom=").concat(t),e.layerRefinery.visible=!0),fetch(i).then((function(e){return e.json()})).then((function(t){var a={type:"simple-line",color:[226,119,40],width:2};t.map((function(t){var i={type:"polyline",paths:[[r,n],[parseFloat(t.X_Coor),parseFloat(t.Y_Coor)]]},o=new h({geometry:i,symbol:a});e.view.graphics.add(o)}))})).then((function(){return s(!0)})).catch((function(e){return console.log("error",e)}))},g=function(){e.view.graphics.removeAll(),e.layerRefinery.visible=!1,s(!1)};return n.a.createElement(n.a.Fragment,null,n.a.createElement(H.a,{title:t.title,style:{fontSize:"12px"},bordered:!0,column:1,size:"small"},d),n.a.createElement(f.a,null),function(){switch(t.title){case"POM":return o?n.a.createElement(c.a,{type:"primary",onClick:g,danger:!0},"Clear"):n.a.createElement(c.a,{type:"primary",onClick:function(){return v(u.pomid,t.title,t.position.longitude,t.position.latitude)}},"Trace");case"Refinery":return 1==o?n.a.createElement(c.a,{type:"primary",onClick:g,danger:!0},"Clear"):n.a.createElement(c.a,{type:"primary",onClick:function(){return v(u.rfid,t.title,t.position.longitude,t.position.latitude)}},"Trace")}}())},I=function(t){console.log("props",t),e.layerPlantationArea.queryFeatures().then((function(e){return console.log("conc area",e)}));var a=Object(r.useState)(0),i=Object(l.a)(a,2),o=i[0],s=i[1],u=Object(r.useState)([]),d=Object(l.a)(u,2),m=d[0],p=d[1],y=Object(r.useState)([]),v=Object(l.a)(y,2),E=v[0],w=v[1],D=[{label:"POM",value:e.layerPom,key:"1"},{label:"Reffinery",value:e.layerRefinery,key:"2"},{label:"Concession Area",value:e.layerPlantationArea,key:"3"},{label:"Peatland",value:e.layerPeat,key:"4"}],M=function(e){e.target.value.visible=e.target.checked,C()},S=function(e){s(e),t.onSliderChange(e),C()},C=function(){D.forEach((function(a,r){var n=a.value;"POM Supplier"==n.title?n.visible?x(n).then((function(e){return p(e.features)})):p([]):"Oil Palm Area"==n.title&&(n.visible?x(n).then(function(){var a=Object(G.a)(N.a.mark((function a(r){var n,i,o;return N.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(n=e.layerDeforestationArea.createQuery()).where="id = '".concat(t.id,"'"),a.next=4,e.layerDeforestationArea.queryFeatures(n);case 4:return i=a.sent,a.next=7,r.features.map(function(){var e=Object(G.a)(N.a.mark((function e(t){var a,r;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.next=3,I(t.geometry,i.features[0].geometry);case 3:return r=e.sent,a.area=r.area,a.intersectGeometry=r.geometry,console.log("f",a),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:o=a.sent,Promise.all(o).then((function(e){return w(e)}));case 9:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()):w([]))}))},I=function(e,t){return j.load().then((function(){var a=new O({wkid:3857}),r=j.project(e,a),n=j.project(t,a);if(k.intersects(r,n)){var i=k.intersect(n,r);console.log("intersect area",i);var o={area:k.geodesicArea(i,"hectares"),geometry:i}}else o="";return o}))},x=function(t){var a=void 0!==e.bufferLayer.graphics.getItemAt(0)&&e.bufferLayer.graphics.getItemAt(0).geometry,r=new P;return r.geometry=a,r.spatialRelationship="intersects",r.returnGeometry=!0,t.queryFeatures(r)},_=function(t,a){console.log("record",a),e.view.goTo({target:t,tilt:70})},A=function(t,a){console.log("data",t);var r=[{title:"Name",dataIndex:"name",key:"name",render:function(e){return n.a.createElement("a",null,e)}},{title:"Action",dataIndex:"action",key:"action",render:function(e,t){return console.log("re",t),n.a.createElement(c.a,{onClick:function(){return _(e.geometry,t)}},"go to")}}],i=[{title:"Names",dataIndex:"name",key:"name",render:function(e){return n.a.createElement("a",null,e)}},{title:"Impacted Area",dataIndex:"area",key:"area",render:function(e){return isNaN(parseFloat(e).toFixed(3))?null:n.a.createElement("span",{style:{color:"red"}},parseFloat(e).toFixed(3)," Ha")}},{title:"Action",dataIndex:"action",key:"action",render:function(t,a){return void 0===a.area?n.a.createElement(c.a,{onClick:function(){return _(t.geometry,a)}},"go to"):n.a.createElement(g.a,null,n.a.createElement(c.a,{onClick:function(){return _(t.geometry,a)}},"go to"),n.a.createElement(c.a,{onClick:function(){return function(t){e.layerIntersectPolygon.removeAll();var a=new h({geometry:t,symbol:{type:"simple-fill",color:[227,139,79,.8],outline:{color:[255,255,255],width:1}}});e.layerIntersectPolygon.add(a),e.view.goTo({target:t,tilt:70})}(t.intersectGeometry)}},"impacted"))}}],o={POM:"PomName",Concession:"Name"};if(t.length>0){console.log(t);var l=t.map((function(e){return{name:e.attributes[o[a]],action:e,area:e.area,intersectGeometry:e.intersectGeometry}}));return n.a.createElement(n.a.Fragment,null,n.a.createElement("h1",null,a),n.a.createElement("div",{style:{padding:"10px"}},n.a.createElement(z.a,{columns:"POM"==a?r:"Concession"==a?i:void 0,dataSource:l,size:"small"})),n.a.createElement(f.a,null))}return null};return n.a.createElement(n.a.Fragment,null,n.a.createElement(H.a,{title:"Detail",column:1,bordered:!0},n.a.createElement(H.a.Item,{label:"Start"},b()(t.attributes.start_date).format("DD/MM/YYYY")),n.a.createElement(H.a.Item,{label:"End"},b()(t.attributes.end_date).format("DD/MM/YYYY")),n.a.createElement(H.a.Item,{label:"Total Area"},t.attributes.total," ha")),n.a.createElement(f.a,null),n.a.createElement("h4",null,"Buffer Radius in Kilometers"),n.a.createElement("div",{style:{position:"relative"}},n.a.createElement(q.a,null,n.a.createElement(U.a,{span:17},n.a.createElement(K.a,{defaultValue:o,max:50,value:"number"===typeof o?o:0,tooltipPlacement:"bottom",onChange:S})),n.a.createElement(U.a,{span:2},n.a.createElement(V.a,{min:0,max:50,style:{margin:"0 16px"},value:o,onChange:S}))),n.a.createElement(f.a,null),n.a.createElement("h4",null,"Show or hide layer"),D.map((function(e){return n.a.createElement(W.a,{key:e.key,value:e.value,onChange:M,checked:e.value.visible},e.label)})),n.a.createElement(f.a,null),A(m,"POM"),A(E,"Concession")),n.a.createElement("div",{style:{position:"sticky",bottom:"0px"}},n.a.createElement(g.a,null,n.a.createElement(c.a,{type:"primary",onClick:function(){var a=void 0!==e.bufferLayer.graphics.getItemAt(0)&&e.bufferLayer.graphics.getItemAt(0).geometry;if(a){var r=new P;r.geometry=a,r.spatialRelationship="intersects",r.returnGeometry=!0,r.outFields="*",r.outSpatialReference={wkid:4326};var n=new P;n.outFields="*",n.returnGeometry=!0,n.where="id = '".concat(t.id,"'");var i=new P;i.outFields="*",i.geometry=a,i.returnGeometry=!0,i.spatialRelationship="intersects",i.where="Acq_Date between date'".concat(b()(t.attributes.start_date).format("YYYY-MM-DD"),"' and '").concat(b()(t.attributes.end_date).format("YYYY-MM-DD"),"'"),e.layerDeforestationArea.queryFeatures(n).then((function(t){e.setState({dfrsAreaGeom:t.features[0].geometry})})),e.setState({isLoading:!0}),Promise.all([e.layerPom.queryFeatures(r),e.layerPlantationArea.queryFeatures(r),e.layerPeat.queryFeatures(r),e.layerHotspot.queryFeatures(i)]).then((function(t){var a=t.map((function(e){return e.features}));console.log("fs",a),e.setState({modalData:a})})).then((function(){return e.setState({showModal:!0,isLoading:!1})}))}}},"Show List"))))},x=function(t,a){console.log(t,a);var r=document.createElement("div");if("POM"===a)Q.content=r,o.a.render(n.a.createElement(C,{data:t.graphic.attributes,title:a,position:{latitude:t.graphic.geometry.latitude,longitude:t.graphic.geometry.longitude}}),r);else if("Deforestation Point"===a||"Deforestation Area"===a){ee.content=r;o.a.render(n.a.createElement(I,{id:t.graphic.attributes.id,onSliderChange:function(a){var r=t.graphic.geometry;console.log("point Geometry",r),e.setState({dfrsPointGeom:r}),function(t,a){if(a>0){var r=k.geodesicBuffer(t,a,"kilometers");0===e.bufferLayer.graphics.length?e.bufferLayer.add(new h({geometry:r,symbol:{type:"simple-fill",color:[140,140,222,.5],outline:{color:[0,0,0,.5],width:2}}})):e.bufferLayer.graphics.getItemAt(0).geometry=r}else e.bufferLayer.removeAll()}(r,a)},attributes:t.graphic.attributes}),r)}else Q.content=r,o.a.render(n.a.createElement(C,{data:t.graphic.attributes,title:a,position:{latitude:t.graphic.geometry.latitude,longitude:t.graphic.geometry.longitude}}),r);return r};e.map=new i({basemap:"streets-night-vector"}),e.view=new s({container:e.mapRef.current,map:e.map,center:[118,0],zoom:4,popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,breakpoint:!1,position:"top-left"}}}),e.layerPlantationPoint=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/OilPalm_Plantation_TP_Supplier/MapServer/0",title:"Oil Palm Plantation",visible:!1,outFields:["*"]}),e.layerPlantationArea=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Third_Party_Supplier/MapServer/2",title:"Oil Palm Area",visible:!1,outFields:["*"]}),e.layerPeat=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Layer_Fungsi_Ekosistem_Gambut_201907_sde/MapServer/0",title:"Peat Ecosystem",visible:!1,outFields:["*"]}),e.layerPkCrushing=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/industries_MIL1/MapServer/0",title:"3rd PK Crushing",visible:!1}),e.layerRefinery=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Layer_Refinery_201908_sde/MapServer/0",title:"Refinery",visible:!1,popupEnabled:!0,outFields:["*"]}),e.layerPom=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Third_Party_Supplier_2020/MapServer/1",title:"3rd Party Mill",visible:!1,popupEnabled:!0,outFields:["pomid","PomName","CompanyNam","PlaceName","Tankcap","Silocap"]}),e.layerDeforestationPoint=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Deforestation/MapServer/0",title:"Deforestation Point",visible:!1,popupEnabled:!0,outFields:["*"]}),e.map.add(e.layerDeforestationPoint),e.layerDeforestationArea=new y({url:"https://gisportal.wilmar.co.id/arcgisserver/rest/services/third_party/idn11def3_period/MapServer/0",title:"Deforestation Area",visible:!1,outFields:["*"]});new u({url:"https://gisportal.wilmar.co.id/arcgisserver/rest/services/Hosted/Wilmar_Basemap2/VectorTileServer?f=pjson"});e.layerHotspot=new y({url:"https://idjktsvr10.wil.local/arcgis/rest/services/NewGISInteractiveMap/Hotspot_HSP1/MapServer/0",title:"Hotspot",visible:!1,outFields:["*"]}),e.map.add(e.layerHotspot),e.sketchLayer=new E({listMode:"hide"}),e.bufferLayer=new E({listMode:"hide"}),e.map.addMany([e.sketchLayer,e.bufferLayer]);var _=new v({title:"Wilmar Third Party"}),A=(new v({title:"Plantation"}),new v({title:"Deforestation"})),F=new v({title:"Land Issue"});_.addMany([e.layerRefinery,e.layerPom,e.layerPkCrushing,e.layerPlantationArea,e.layerPlantationPoint]),A.addMany([e.layerDeforestationArea,e.layerDeforestationPoint]),F.addMany([e.layerPeat]),e.map.addMany([_,A,F]),e.layerIntersectPolygon=new E({title:"intersected"}),e.map.add(e.layerIntersectPolygon);var Y=new S({view:e.view});e.view.ui.components=[],e.view.ui.add(Y,"top-right");var T=new d({view:e.view}),L=new m({view:e.view,content:T,expandTooltip:"Change Basemap"});e.view.ui.add(L,"top-right");var R=new p({view:e.view}),B=new m({view:e.view,content:R,expandTooltip:"Layer List"});e.view.ui.add(B,"top-right");var J=new w({view:e.view});e.view.ui.add(J,"bottom-right");new M({container:"timeSlider",playRate:50,stops:{interval:{value:1,unit:"hours"}}});var Q={title:"POM Suplier",content:function(e){return x(e,"POM")}};e.layerPom.popupTemplate=Q;var Z={title:"Refinery",content:function(e){return x(e,"Refinery")}};e.layerRefinery.popupTemplate=Z;var X={title:"Concession Area",content:function(e){return x(e,"Concession Area")}};e.layerPlantationArea.popupTemplate=X;var $={title:"Hotspot",content:function(e){return x(e,"Hotspot")}};e.layerHotspot.popupTemplate=$;var ee={title:"Deforestation Point",content:function(e){return x(e,"Deforestation Point")}};e.layerDeforestationPoint.popupTemplate=ee;var te={title:"Deforestation Area",content:function(e){return x(e,"Deforestation Area")}};e.layerDeforestationArea.popupTemplate=te,e.view.when((function(){return e.view.whenLayerView(e.layerIntersectPolygon).then((function(t){e.view.on("pointer-move",(function(t){if(void 0!==e.layerIntersectPolygon.graphics.getItemAt(0)){var a={x:t.x,y:t.y};e.view.hitTest(a).then((function(e){e.results.forEach((function(e){"intersected"==e.graphic.layer.title&&console.log("elelee",e)}))}))}}))}))})),D.whenTrue(e.view,"stationary",(function(){e.view.zoom>=10?(console.log(e.view.zoom),e.layerDeforestationArea.visible=!!e.layerDeforestationPoint.visible):e.layerDeforestationArea.visible=!1}))}))}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillMount",value:function(){this.view&&(this.view.container=null)}},{key:"render",value:function(){var e,t=this;if(null==this.state.dfrsResult)e=n.a.createElement(J.a,{title:"Please choose date range"});else if(0==this.state.dfrsResult.length)e=n.a.createElement(Q.a,null);else{var a=[];this.state.dfrsResult.map((function(e,r){var n={key:r,lat:e.attributes.POINT_X,lon:e.attributes.POINT_Y,startdate:e.attributes.start_date,enddate:e.attributes.end_date,peatland:e.attributes.peatland,mangrove:e.attributes.mangrove,other:e.attributes.other,total:e.attributes.total,konsesi:parseFloat(e.attributes.SUM_konses/1e3).toFixed(2),peat:parseFloat(e.attributes.SUM_peat_/1e3).toFixed(2),zoomTo:function(){return t.f_zoomTo(e)},impacted:0!==e.attributes.SUM_konses},i=0!==e.attributes.SUM_konses?1:0;a.push({sorter:i,data:n})}));var r=ye.orderBy(a,["sorter"],["desc"]);console.log(r);var i=ye.map(r,(function(e,t){var a=Object(S.a)(Object(S.a)({},e.data),{},{index:t+1});return n.a.createElement(ne,{key:a.key,lat:a.lat,lon:a.lon,startdate:a.startdate,enddate:a.enddate,peatland:a.peatland,mangrove:a.mangrove,konsesi:a.konsesi,peat:a.peat,other:a.other,total:a.total,index:a.index,zoomTo:a.zoomTo,impacted:a.impacted})}));e=n.a.createElement(g.a,{direction:"vertical"},i)}return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"webmap",ref:this.mapRef}),n.a.createElement("div",{className:"spinner"},n.a.createElement(Z.a,{spinning:this.state.isLoading,size:"large",tip:"Loading..."})),n.a.createElement(D,{onClick:function(){return t.f_showDrawer(!0)},count:4}),n.a.createElement(ee,{onClick:this.f_clearBufferLayers}),n.a.createElement(ae,{className:"button-hotspot",onClick:function(){return t.layerHotspot.visible=!t.layerHotspot.visible}}),n.a.createElement(u.a,{title:"Deforestation",placement:"right",closable:!0,onClose:function(){return t.f_showDrawer(!1)},visible:this.state.isDrawerShow,width:500},n.a.createElement(k,{timesRange:this.f_getDatesRange(b()("20190215"),b()()),onFinish:this.f_dfrsFormOnFinish,onClear:this.f_onClear}),n.a.createElement(f.a,null),this.state.dfrsResult.length>0?n.a.createElement(c.a,{onClick:this.f_downloadPdf,block:!0},"Download PDF"):null,n.a.createElement(f.a,null),n.a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},e)),n.a.createElement(X.a,{title:"Detail",visible:this.state.showModal,onOk:function(e){return t.setState({showModal:!1})},onCancel:function(e){return t.setState({showModal:!1})},width:"80vw",destroyOnClose:!0},n.a.createElement(fe,{data:this.state.modalData,location:this.state.dfrsPointGeom,dfrsArea:this.state.dfrsAreaGeom})))}}]),a}(n.a.Component);he.contextType=x;var be=he,Ee=a(644),we=function(e){return n.a.createElement(Ee.a,{value:e.value})},ke=a(46),De=[{name:"Have Plantation",value:310},{name:"Not have Plantation",value:190}],Pe=["#0088FE","#00C49F","#FFBB28","#FF8042"],Me=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(j.a)(this,a),t.apply(this,arguments)}return Object(O.a)(a,[{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(ke.f,{width:400,height:400},n.a.createElement(ke.e,{dataKey:"value",isAnimationActive:!1,data:De,cx:200,cy:200,outerRadius:100,fill:"#8884d8",innerRadius:60,label:!0},De.map((function(e,t){return n.a.createElement(ke.d,{fill:Pe[t%Pe.length]})}))),n.a.createElement(ke.g,null)))}}]),a}(r.PureComponent);Me.jsfiddleUrl="https://jsfiddle.net/alidingling/k9jkog04/";var Se=[{name:"Peat Area",value:290},{name:"Peat Loss",value:10}],je=["#FFBB28","#FF8042"];(function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(j.a)(this,a),t.apply(this,arguments)}return Object(O.a)(a,[{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(ke.f,{width:400,height:400},n.a.createElement(ke.e,{dataKey:"value",isAnimationActive:!1,data:Se,cx:200,cy:200,outerRadius:100,fill:"#8884d8",innerRadius:60,label:!0},Se.map((function(e,t){return n.a.createElement(ke.d,{fill:je[t%je.length]})}))),n.a.createElement(ke.g,null)))}}]),a}(r.PureComponent)).jsfiddleUrl="https://jsfiddle.net/alidingling/k9jkog04/";var Oe=[{name:"Jan",area:1.2},{name:"Feb",area:2.2},{name:"Mar",area:3.2},{name:"Apr",area:2.9},{name:"May",area:2.2},{name:"June",area:1.9},{name:"Jul",area:2},{name:"Aug",area:.5},{name:"Sep",area:.6},{name:"Oct",area:.2},{name:"Nov",area:1.1},{name:"Dec",area:1.3}],Ce=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(j.a)(this,a),t.apply(this,arguments)}return Object(O.a)(a,[{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(ke.b,{width:900,height:100,data:Oe,margin:{top:20,left:20,bottom:20,right:20}},n.a.createElement(ke.c,{strokeDasharray:"3 3"}),n.a.createElement(ke.h,{dataKey:"name"}),n.a.createElement(ke.i,null),n.a.createElement(ke.g,null),n.a.createElement(ke.a,{type:"monotone",dataKey:"area",stroke:"#8884d8",fill:"#8884d8"})))}}]),a}(r.PureComponent);Ce.jsfiddleUrl="https://jsfiddle.net/alidingling/Lrffmzfc/";var Ie=function(e){Object(C.a)(a,e);var t=Object(I.a)(a);function a(){return Object(j.a)(this,a),t.apply(this,arguments)}return Object(O.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"dashboard-wrapper"},n.a.createElement(q.a,null,n.a.createElement(U.a,{span:8},n.a.createElement("div",{style:{height:"45vh"}},n.a.createElement(re.a,{title:"Total Cover Loss(Ha)",style:{height:"50%"}},n.a.createElement(we,{value:12e3})),n.a.createElement(re.a,{title:"Total Cover Loss(Ha)",style:{height:"50%"}},n.a.createElement(we,{value:12e3})))),n.a.createElement(U.a,{span:16},n.a.createElement("div",{style:{height:"45vh"}},n.a.createElement(re.a,{title:"Deforestation by Month",style:{height:"100%"}},n.a.createElement(Ce,null))))),n.a.createElement(q.a,{style:{height:"45vh"}},n.a.createElement(U.a,{span:8},n.a.createElement("div",{style:{maxHeight:"45vh"}},n.a.createElement(re.a,{title:"Concession Ratio",style:{height:"100%"}},n.a.createElement(Me,null)))),n.a.createElement(U.a,{span:8},n.a.createElement("div",{style:{maxHeight:"50vh"}},n.a.createElement(re.a,{title:"Concession Ratio",style:{height:"100%"}},n.a.createElement(Me,null)))),n.a.createElement(U.a,{span:8},n.a.createElement("div",{style:{maxHeight:"50vh"}},n.a.createElement(re.a,{title:"Concession Ratio",style:{height:"100%"}},n.a.createElement(Me,null))))))}}]),a}(n.a.Component),xe=(a(626),M.a.Content);var _e=function(){return n.a.createElement(F,null,n.a.createElement(M.a,{style:{minHeight:"100vh"}},n.a.createElement(L,null),n.a.createElement(M.a,{className:"site-layout"},n.a.createElement(xe,{style:{margin:"0 0px"}},n.a.createElement("div",{className:"site-layout-background",style:{minHeight:"100vh"}},n.a.createElement(A,null,(function(e){return"dashboard"==e.activePage?n.a.createElement(Ie,null):"map"==e.activePage?n.a.createElement(be,null):void 0})))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(_e,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[357,1,2]]]);
//# sourceMappingURL=main.3b5dac36.chunk.js.map